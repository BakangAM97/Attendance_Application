<div class="container">
  <div class="row show-row">
    <div class="col-md-6 show-containers">
      <%= image_tag("profile_placeholder" , size: "200x200", class: "show-profile") %>
    </div>
    <div class="col-md-6 show-containers">
      <table>
        <tr>
          <td><h1><%= @student.name.capitalize %></h1></td>
          <td><%if @student.active == true %>
            <h1><span class="badge badge-success">Active</span></h1>
            <%else%>
            <h1><span class="badge badge-secondary">Inactive</span></h1>
            <%end%>
          </td>
        </tr>
        <tr>
          <td><h1>Group</h1></td>
          <td><h1><span class="badge badge-info"><%= @group.name.upcase %></span></h1></td>
        </tr>
        <tr>
          <td><h1>Stream</h1></td>
          <td><h1><span class="badge badge-info"><%=@group.stream.upcase %></span></h1></td>
        </tr>
      </table>
    </div>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th scope="col">On Time</th>
        <th scope="col">< 5 mins</th>
        <th scope="col">> 5 mins</th>
        <th scope="col">Authorised</th>
        <th scope="col">Unauthorised</th>
      </tr>
    </thead>
    <tbody>

      <% att_array = [0, 0, 0, 0, 0]
         percArray = [0, 0, 0, 0, 0] %>

      <tr>

        <% @student.attendances.each do |attendance| %>

          <%

          case attendance.att_status
          when 1
            att_array[0] += 1
          when 2
            att_array[1] += 1
          when 3
            att_array[2] += 1
          when 4
            att_array[3] += 1
          when 5
            att_array[4] += 1
          end

          %>

        <% end %>

        <%

        sum = 0.0

        att_array.each do |value|
          sum+=value
        end

        percArray[0] = ((att_array[0] / sum) * 100).round 2
        percArray[1] = ((att_array[1] / sum) * 100).round 2
        percArray[2] = ((att_array[2] / sum) * 100).round 2
        percArray[3] = ((att_array[3] / sum) * 100).round 2
        percArray[4] = ((att_array[4] / sum) * 100).round 2

        %>

        <td><%= percArray[0] %>%</td>
        <td><%= percArray[1] %>%</td>
        <td><%= percArray[2] %>%</td>
        <td><%= percArray[3] %>%</td>
        <td><%= percArray[4] %>%</td>

      </tr>
    </tbody>
  </table>

<!-- CALENDAR ----------------->

  <table class="table table-bordered">
  <thead>
    <tr>
      <th scope="col" class="weekSize">Week</th>
      <th scope="col" class="otherSize">Monday</th>
      <th scope="col" class="otherSize">Tuesday</th>
      <th scope="col" class="otherSize">Wednesday</th>
      <th scope="col" class="otherSize">Thursday</th>
      <th scope="col" class="otherSize">Friday</th>
    </tr>
  </thead>
  <tbody>
    <% @group.startdate %>
    <% @group.enddate %>
    <% cDays = (@group.enddate - @group.startdate).to_f %>
    <h3>Total Weeks: <%= cWeeks = (cDays / 7).ceil %></h3>

    <!-- Polulates calendar with attendance types (1 - 5) -->
    <!-- Will PUT weekend dates in weekdays if weekends are included in attendances -->
    <%# TODO: FIX ABOVE %>

    <% count = -5 %>
    <% (1..cWeeks).each do |i| %>
    <% count = count + 5 %>
      <tr>
        <th scope="row"><%= i %></th>

        <% (0..4).each do |j| %>
          <% if @student.attendances[count + j].nil? %>
            <td></td>
          <% else %>
            <%
            className = ""
            case @student.attendances[count + j].att_status
            when 1
              className = "on_time"
            when 2
              className = "less_than_five"
            when 3
              className = "more_than_five"
            when 4
              className = "auth"
            when 5
              className = "unauth"
            end
            %>
            <td class="<%= className %>"></td>
          <% end %>
        <% end %>

      </tr>
    <% end %>
  </tbody>
</table>

<!-- END OF CALENDAR ------------------>

<!-- Key -->

<h2 class="calendarkey">Key</h2>

<div class="row calendarkey">

  <div class="col">
    <p>On Time:</p>
  </div>
  <div class="col on_time">

  </div>

  <div class="col">
    <p>< 5 mins:</p>
  </div>
  <div class="col less_than_five">

  </div>

  <div class="col">
    <p>> 5 mins:</p>
  </div>
  <div class="col more_than_five">

  </div>

  <div class="col">
    <p>Authorised</p>
  </div>
  <div class="col auth">

  </div>

  <div class="col">
    <p>Unauthorised</p>
  </div>
  <div class="col unauth">

  </div>

</div>

  <div class="actions-list">
    <%= link_to "Edit Student", edit_student_path, class: "btn btn-primary" %>
    <%= link_to "Delete Student", @student, method: :delete, class: "btn btn-danger" %>
  </div>
</div>

<br>
<br>

<button type="button" class="btn btn-lg btn-danger" data-toggle="popover" title="Popover title" data-content="And here's some amazing content. It's very engaging. Right?">Click to toggle popover</button>
